---
import type { ParkSchema } from "@/types/park";
import BackTo from "@components/Navigation/BackTo/BackTo.astro";
import Layout from "@layouts/Layout.astro";
import { getCollection, getEntry, type CollectionEntry } from "astro:content";
import type { GetStaticPaths } from 'astro';
import { getUsStateName } from '@lib/helpers'
import { Icon } from "astro-icon/components";

export const getStaticPaths = (async () => {
  const response = await fetch('http://localhost:4321/api/parks.json');
  const parks = await response.json();
  const activitiesList = new Set();

  parks.forEach((park: ParkSchema) => {
    park?.data?.activities.forEach(activity => {
      activitiesList.add(activity);
    })
  })

  const sortedActivitiesList = [...activitiesList];
  sortedActivitiesList.sort();

  return sortedActivitiesList.map((activity: string ) => ({
    params: { activity: activity.replace(/\s+/g, '-').toLowerCase() as string },
    props: { activity },
  }));
}) satisfies GetStaticPaths;

const { activity } = Astro.props;
const response = await fetch('http://localhost:4321/api/parks.json');
const parks = await response.json();
const parksList = parks.filter((park: ParkSchema) => park.data.activities.includes(activity));
const parksListSorted = parksList.sort((a: ParkSchema, b: ParkSchema) => a.data.name.localeCompare(b.data.name));

---
<Layout>

  <div class="mx-auto max-w-screen-xl">
    <header class="mb-8">
      <BackTo class="mt-3" href="/parks/activities" title="Return to all park activities list">Back to All Park Activities</BackTo>
      <hgroup class="flex flex-col gap-2 align-baseline my-8">
        <p class="text-sm text-gray-600">Activity</p>
        <h1 class="text-3xl font-bold">{activity}</h1>
      </hgroup>
    </header>

    <p>The following {parksListSorted.length} park(s) are associated with the activity <em>"{activity}"</em></p>

    {parksListSorted.length && (
      <ul class="columns-md gap-4 my-12 pb-12">
        {parksListSorted.map((park: ParkSchema) => {
          const url = "/parks/park/" + park.data.name?.replace(/\s+/g, '-').toLowerCase() as string;
          return (
            <li class="mb-2"><a class="text-blue-500 hover:text-blue-700" href={url}>{park.data.fullName}</a></li>
          )
        })}
      </ul>
    )}
  </div>
</Layout>
